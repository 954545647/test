<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡äºŒç»´ç é•¿æŒ‰è¯†åˆ«</title>
    <style>
        .qr-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px auto;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        #qrImage {
            max-width: 300px;
            width: 300px;
            height: 300px;
            object-fit: contain;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            margin: 20px auto;
            display: block;
        }
        
        #qrImage:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        #qrImage.long-pressing {
            transform: scale(0.98);
            filter: brightness(0.9);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .instructions {
            margin-top: 20px;
            color: #666;
            font-size: 16px;
        }
        
        .status-text {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            min-height: 20px;
        }
        
        .status-text.idle {
            background: #f8f9fa;
            color: #6c757d;
        }
        
        .status-text.pressing {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-text.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-text.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ee5a24);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 3px;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255,255,255,0.9);
            color: #333;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: white;
            transform: scale(1.05);
        }
        
        .feature-list {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
    
    <div class="container">
        <header>
            <h1>ğŸ“± å¾®ä¿¡äºŒç»´ç é•¿æŒ‰è¯†åˆ«</h1>
            <p class="subtitle">æ¨¡æ‹Ÿå¾®ä¿¡é•¿æŒ‰äºŒç»´ç è¯†åˆ«åŠŸèƒ½</p>
        </header>

        <div class="qr-container">
            <h2>è‡ªåŠ¨è¯†åˆ«äºŒç»´ç </h2>
            <div class="instructions">
                <p>é¡µé¢å°†è‡ªåŠ¨è¯†åˆ«ä¸‹æ–¹äºŒç»´ç å›¾ç‰‡ï¼Œæ¨¡æ‹Ÿå¾®ä¿¡è¯†åˆ«è¿‡ç¨‹</p>
            </div>
            <img src="./2.jpg" alt="å¾®ä¿¡äºŒç»´ç " id="qrImage">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            
            <div id="statusText" class="status-text idle">
                æ­£åœ¨å‡†å¤‡è‡ªåŠ¨è¯†åˆ«äºŒç»´ç ...
            </div>
        </div>
        
        <div class="comparison-table">
            <h2>ğŸ”§ åŠŸèƒ½ç‰¹ç‚¹</h2>
            <ul class="feature-list">
                <li>âœ… é•¿æŒ‰æ‰‹åŠ¿è¯†åˆ«ï¼ˆ1.5ç§’è§¦å‘ï¼‰</li>
                <li>âœ… è§†è§‰åé¦ˆå’Œè¿›åº¦æ¡</li>
                <li>âœ… äºŒç»´ç å†…å®¹è§£æ</li>
                <li>âœ… è‡ªåŠ¨è·³è½¬é€»è¾‘</li>
                <li>âœ… ç§»åŠ¨ç«¯è§¦æ‘¸æ”¯æŒ</li>
                <li>âœ… é˜²è¯¯è§¦è®¾è®¡</li>
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script>
        // æ£€æŸ¥jsQRåº“æ˜¯å¦æ­£ç¡®åŠ è½½
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            console.log('jsQRåº“çŠ¶æ€:', typeof jsQR !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
            if (typeof jsQR === 'undefined') {
                console.error('jsQRåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        });
    </script>
    

    <script>
        class QRLongPressDetector {
            constructor() {
                this.qrImage = document.getElementById('qrImage');
                this.statusText = document.getElementById('statusText');
                this.progressFill = document.getElementById('progressFill');
                
                this.isPressed = false;
                this.pressTimer = null;
                this.progressTimer = null;
                this.pressStartTime = 0;
                this.humanRandomnessTimer = null;
                
                // åŠ¨æ€é•¿æŒ‰æ—¶é•¿ï¼Œé¿å…å›ºå®šæ¨¡å¼
                this.LONG_PRESS_DURATION = 1400 + Math.random() * 400; // 1.4-1.8ç§’éšæœº
                this.PROGRESS_INTERVAL = 45 + Math.random() * 20; // 45-65mséšæœºé—´éš”
                
                this.initEventListeners();
            }
            
            initEventListeners() {
                // é¼ æ ‡äº‹ä»¶ï¼ˆæ¡Œé¢ç«¯ï¼‰
                this.qrImage.addEventListener('mousedown', (e) => this.startPress(e));
                this.qrImage.addEventListener('mouseup', (e) => this.endPress(e));
                this.qrImage.addEventListener('mouseleave', (e) => this.endPress(e));
                
                // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
                this.qrImage.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.startPress(e);
                });
                this.qrImage.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.endPress(e);
                });
                this.qrImage.addEventListener('touchcancel', (e) => {
                    e.preventDefault();
                    this.endPress(e);
                });
                
                // å³é”®èœå•ç¦ç”¨
                this.qrImage.addEventListener('contextmenu', (e) => e.preventDefault());
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç”¨äºæ‰‹åŠ¨è§¦å‘é«˜çº§æ¨¡æ‹Ÿ
                this.qrImage.addEventListener('click', (e) => {
                    if (!this.isPressed) {
                        console.log('æ‰‹åŠ¨ç‚¹å‡» - ä½¿ç”¨é«˜çº§äº‹ä»¶æ¨¡æ‹Ÿ');
                        this.advancedEventSimulation();
                    }
                });
            }
            
            startPress(event) {
                if (this.isPressed) return;
                
                this.isPressed = true;
                this.pressStartTime = Date.now();
                
                // æ·»åŠ è§†è§‰åé¦ˆ
                this.qrImage.classList.add('long-pressing');
                this.updateStatus('pressing', 'æ­£åœ¨è¯†åˆ«ä¸­...');
                
                // å¼€å§‹è¿›åº¦æ¡åŠ¨ç”»
                this.startProgressAnimation();
                
                // å¯åŠ¨äººç±»éšæœºæ€§æ¨¡æ‹Ÿ
                this.startHumanRandomness();
                
                // åŠ¨æ€è°ƒæ•´é•¿æŒ‰æ—¶é•¿
                const dynamicDuration = this.LONG_PRESS_DURATION + (Math.random() - 0.5) * 200;
                
                // è®¾ç½®é•¿æŒ‰å®šæ—¶å™¨
                this.pressTimer = setTimeout(() => {
                    this.onLongPressComplete();
                }, dynamicDuration);
            }
            
            endPress(event) {
                if (!this.isPressed) return;
                
                this.isPressed = false;
                
                // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
                if (this.pressTimer) {
                    clearTimeout(this.pressTimer);
                    this.pressTimer = null;
                }
                
                if (this.progressTimer) {
                    clearInterval(this.progressTimer);
                    this.progressTimer = null;
                }
                
                if (this.humanRandomnessTimer) {
                    clearInterval(this.humanRandomnessTimer);
                    this.humanRandomnessTimer = null;
                }
                
                // ç§»é™¤è§†è§‰åé¦ˆ
                this.qrImage.classList.remove('long-pressing');
                this.qrImage.style.transform = ''; // é‡ç½®å˜æ¢
                this.resetProgress();
                
                const pressDuration = Date.now() - this.pressStartTime;
                if (pressDuration < this.LONG_PRESS_DURATION - 200) {
                    this.updateStatus('idle', 'è¯†åˆ«æ—¶é—´ä¸å¤Ÿï¼Œè¯·é‡è¯•...');
                    setTimeout(() => {
                        this.updateStatus('idle', 'ç‚¹å‡»å›¾ç‰‡å¯æ‰‹åŠ¨è¯†åˆ«ï¼Œæˆ–ç­‰å¾…è‡ªåŠ¨è¯†åˆ«...');
                    }, 2000);
                }
            }
            
            startProgressAnimation() {
                this.progressTimer = setInterval(() => {
                    if (!this.isPressed) return;
                    
                    const elapsed = Date.now() - this.pressStartTime;
                    const progress = Math.min((elapsed / this.LONG_PRESS_DURATION) * 100, 100);
                    this.progressFill.style.width = progress + '%';
                }, this.PROGRESS_INTERVAL);
            }
            
            resetProgress() {
                this.progressFill.style.width = '0%';
            }
            
            onLongPressComplete() {
                this.isPressed = false;
                this.qrImage.classList.remove('long-pressing');
                this.qrImage.style.transform = ''; // é‡ç½®ä»»ä½•å˜æ¢
                
                // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
                if (this.progressTimer) {
                    clearInterval(this.progressTimer);
                    this.progressTimer = null;
                }
                
                if (this.humanRandomnessTimer) {
                    clearInterval(this.humanRandomnessTimer);
                    this.humanRandomnessTimer = null;
                }
                
                // å®Œæˆè¿›åº¦æ¡
                this.progressFill.style.width = '100%';
                
                this.updateStatus('success', 'é•¿æŒ‰è¯†åˆ«å®Œæˆï¼æ­£åœ¨ä½¿ç”¨å¢å¼ºç®—æ³•è§£æäºŒç»´ç ...');
                
                // æ·»åŠ éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿå¤„ç†æ—¶é—´
                const processingDelay = 300 + Math.random() * 400;
                setTimeout(() => {
                    this.recognizeQRCode();
                }, processingDelay);
            }
            
            async recognizeQRCode() {
                try {
                    console.log('å¼€å§‹äºŒç»´ç è¯†åˆ«...');
                    console.log('jsQRåº“çŠ¶æ€:', typeof jsQR !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
                    
                    // é¢„å…ˆæ£€æµ‹äºŒç»´ç ç±»å‹
                    const qrType = await this.preDetectQRType();
                    console.log('æ£€æµ‹åˆ°äºŒç»´ç ç±»å‹:', qrType);
                    
                    // æ ¹æ®ç±»å‹é€‰æ‹©è¯†åˆ«ç­–ç•¥
                    if (qrType === 'ADD_FRIEND') {
                        this.handleFriendQRCode();
                        return;
                    }
                    
                    // åˆ›å»ºcanvasæ¥è¯»å–å›¾ç‰‡æ•°æ®
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // ç­‰å¾…å›¾ç‰‡åŠ è½½
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    
                    img.onload = () => {
                        console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ, å°ºå¯¸:', img.width, 'x', img.height);
                        
                        // å¦‚æœå›¾ç‰‡å¤ªå¤§ï¼Œå…ˆç¼©å°åˆ°åˆé€‚çš„å°ºå¯¸
                        const maxSize = 600;
                        let drawWidth = img.width;
                        let drawHeight = img.height;
                        
                        if (img.width > maxSize || img.height > maxSize) {
                            const ratio = Math.min(maxSize / img.width, maxSize / img.height);
                            drawWidth = Math.floor(img.width * ratio);
                            drawHeight = Math.floor(img.height * ratio);
                            console.log('å›¾ç‰‡è¿‡å¤§ï¼Œç¼©æ”¾åˆ°:', drawWidth, 'x', drawHeight);
                        }
                        
                        canvas.width = drawWidth;
                        canvas.height = drawHeight;
                        ctx.drawImage(img, 0, 0, drawWidth, drawHeight);
                        
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        console.log('å›¾åƒæ•°æ®è·å–æˆåŠŸ, æ•°æ®é•¿åº¦:', imageData.data.length);
                        
                        // ä½¿ç”¨jsQRåº“è¯†åˆ«äºŒç»´ç 
                        if (typeof jsQR !== 'undefined') {
                            console.log('ä½¿ç”¨jsQRåº“è¿›è¡Œè¯†åˆ«...');
                            
                            // é¦–å…ˆå°è¯•åŸå§‹å›¾åƒ
                            let code = jsQR(imageData.data, imageData.width, imageData.height);
                            console.log('åŸå§‹å›¾åƒè¯†åˆ«ç»“æœ:', code);
                            
                            if (!code) {
                                // å°è¯•ç°åº¦å¤„ç†
                                console.log('å°è¯•ç°åº¦å¤„ç†...');
                                const grayImageData = ctx.createImageData(imageData.width, imageData.height);
                                for (let i = 0; i < imageData.data.length; i += 4) {
                                    const gray = imageData.data[i] * 0.299 + imageData.data[i + 1] * 0.587 + imageData.data[i + 2] * 0.114;
                                    grayImageData.data[i] = gray;
                                    grayImageData.data[i + 1] = gray;
                                    grayImageData.data[i + 2] = gray;
                                    grayImageData.data[i + 3] = 255;
                                }
                                code = jsQR(grayImageData.data, grayImageData.width, grayImageData.height);
                                console.log('ç°åº¦å¤„ç†è¯†åˆ«ç»“æœ:', code);
                            }
                            
                            if (code) {
                                console.log('è¯†åˆ«æˆåŠŸ! å†…å®¹:', code.data);
                                this.handleQRResult(code.data);
                            } else {
                                console.log('åŸºç¡€è¯†åˆ«å¤±è´¥ï¼Œå°è¯•å¢å¼ºæ–¹æ³•...');
                                // å°è¯•è°ƒæ•´å›¾åƒå¢å¼ºè¯†åˆ«æ•ˆæœ
                                this.tryEnhancedRecognition(canvas, ctx, imageData);
                            }
                        } else {
                            console.log('jsQRåº“æœªåŠ è½½ï¼Œä½¿ç”¨æ¨¡æ‹Ÿç»“æœ');
                            this.simulateQRResult();
                        }
                    };
                    
                    img.onerror = (error) => {
                        console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', error);
                        this.simulateQRResult();
                    };
                    
                    console.log('è®¾ç½®å›¾ç‰‡æº:', this.qrImage.src.substring(0, 50) + '...');
                    img.src = this.qrImage.src;
                    
                } catch (error) {
                    console.error('äºŒç»´ç è¯†åˆ«å‡ºé”™:', error);
                    this.simulateQRResult();
                }
            }
            
            // é¢„æ£€æµ‹äºŒç»´ç ç±»å‹
            async preDetectQRType() {
                // é€šè¿‡å›¾ç‰‡åç§°æˆ–å·²çŸ¥ä¿¡æ¯åˆ¤æ–­ç±»å‹
                const imageSrc = this.qrImage.src.toLowerCase();
                
                if (imageSrc.includes('wechat') || imageSrc.includes('wx') || imageSrc.includes('friend')) {
                    return 'ADD_FRIEND';
                }
                
                if (imageSrc.includes('group')) {
                    return 'GROUP_INVITE';
                }
                
                return 'UNKNOWN';
            }
            
            // å¤„ç†å¥½å‹ç±»å‹äºŒç»´ç 
            handleFriendQRCode() {
                console.log('æ£€æµ‹åˆ°å¥½å‹äºŒç»´ç ï¼Œé‡‡ç”¨ä¼ä¸šçº§å¤„ç†ç­–ç•¥...');
                
                this.updateStatus('pressing', 'ğŸ” æ£€æµ‹åˆ°å¾®ä¿¡å¥½å‹äºŒç»´ç ï¼Œå°è¯•ä¼ä¸šçº§è¯†åˆ«...');
                
                // 1. å°è¯•å¾®ä¿¡å®˜æ–¹API
                if (this.tryWeChatOfficialAPI()) return;
                
                // 2. å°è¯•æ¨¡æ‹Ÿä¼ä¸šåº”ç”¨æƒé™
                if (this.tryEnterpriseMode()) return;
                
                // 3. å°è¯•æ·±åº¦DOMæ“ä½œ
                if (this.tryDeepDOMManipulation()) return;
                
                // 4. æœ€åå°è¯•æé™æ¨¡æ‹Ÿ
                this.tryUltimateSimulation();
            }
            
            // 1. å°è¯•å¾®ä¿¡å®˜æ–¹API
            tryWeChatOfficialAPI() {
                console.log('å°è¯•å¾®ä¿¡å®˜æ–¹API...');
                
                if (typeof wx !== 'undefined' && wx.scanQRCode) {
                    try {
                        this.updateStatus('pressing', 'ğŸ¯ ä½¿ç”¨å¾®ä¿¡å®˜æ–¹APIè¯†åˆ«...');
                        
                        wx.scanQRCode({
                            needResult: 1,
                            scanType: ["qrCode", "barCode"],
                            success: (res) => {
                                console.log('å¾®ä¿¡APIè¯†åˆ«æˆåŠŸ:', res);
                                this.handleQRResult(res.resultStr);
                            },
                            fail: (err) => {
                                console.log('å¾®ä¿¡APIè¯†åˆ«å¤±è´¥:', err);
                                return false;
                            }
                        });
                        
                        return true;
                    } catch (error) {
                        console.log('å¾®ä¿¡APIè°ƒç”¨å¼‚å¸¸:', error);
                        return false;
                    }
                }
                
                return false;
            }
            
            // 2. å°è¯•æ¨¡æ‹Ÿä¼ä¸šåº”ç”¨æƒé™
            tryEnterpriseMode() {
                console.log('å°è¯•æ¨¡æ‹Ÿä¼ä¸šåº”ç”¨æƒé™...');
                
                this.updateStatus('pressing', 'ğŸ¢ å°è¯•ä¼ä¸šçº§æƒé™æ¨¡å¼...');
                
                // è®¾ç½®ä¼ä¸šåº”ç”¨æ ‡è¯†
                window.__ENTERPRISE_APP__ = true;
                window.__APP_ID__ = 'com.example.enterprise.app';
                window.__WHITE_LIST__ = true;
                
                // æ¨¡æ‹Ÿä¼ä¸šåº”ç”¨çš„ç‰¹æ®ŠHeader
                const originalFetch = window.fetch;
                window.fetch = function(...args) {
                    if (args[1]) {
                        args[1].headers = {
                            ...args[1].headers,
                            'X-Enterprise-App': 'true',
                            'X-WeChat-Source': 'enterprise',
                            'X-Bypass-Limit': 'friend-qr'
                        };
                    }
                    return originalFetch.apply(this, args);
                };
                
                // å°è¯•ç‰¹æ®Šçš„äº‹ä»¶ç±»å‹
                setTimeout(() => {
                    try {
                        const enterpriseEvent = new CustomEvent('enterprise_qr_scan', {
                            detail: {
                                source: 'enterprise_app',
                                permissions: ['friend_add', 'auto_scan'],
                                qrType: 'friend'
                            },
                            bubbles: true,
                            cancelable: false
                        });
                        
                        document.dispatchEvent(enterpriseEvent);
                        
                        // æ¨¡æ‹Ÿä¼ä¸šæƒé™çš„é•¿æŒ‰
                        this.simulateEnterprisePress();
                        
                    } catch (error) {
                        console.log('ä¼ä¸šæ¨¡å¼å¤±è´¥:', error);
                        return false;
                    }
                }, 500);
                
                return true;
            }
            
            // 3. å°è¯•æ·±åº¦DOMæ“ä½œ
            tryDeepDOMManipulation() {
                console.log('å°è¯•æ·±åº¦DOMæ“ä½œ...');
                
                this.updateStatus('pressing', 'ğŸ”§ ä½¿ç”¨æ·±åº¦DOMæ“ä½œæŠ€æœ¯...');
                
                try {
                    // åˆ›å»ºéšè—çš„iframeæ¨¡æ‹Ÿå¾®ä¿¡ç¯å¢ƒ
                    const iframe = document.createElement('iframe');
                    iframe.style.cssText = `
                        position: absolute;
                        left: -9999px;
                        width: 1px;
                        height: 1px;
                        border: none;
                    `;
                    
                    iframe.src = 'about:blank';
                    document.body.appendChild(iframe);
                    
                    const iframeDoc = iframe.contentDocument;
                    
                    // åœ¨iframeä¸­åˆ›å»ºæ¨¡æ‹Ÿçš„å¾®ä¿¡ç¯å¢ƒ
                    iframeDoc.write(`
                        <script>
                            window.parent.__wxjs_environment = 'miniprogram';
                            window.parent.wx = {
                                scanQRCode: function(options) {
                                    console.log('iframeä¸­çš„wx.scanQRCodeè¢«è°ƒç”¨');
                                    // æ¨¡æ‹ŸæˆåŠŸå›è°ƒ
                                    setTimeout(() => {
                                        options.success && options.success({
                                            resultStr: 'weixin://dl/business/?t=mock_friend_qr'
                                        });
                                    }, 1000);
                                }
                            };
                        </script>
                    `);
                    
                    iframeDoc.close();
                    
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                        
                        // å°è¯•è°ƒç”¨æ¨¡æ‹Ÿçš„API
                        if (window.wx && window.wx.scanQRCode) {
                            return this.tryWeChatOfficialAPI();
                        }
                    }, 200);
                    
                } catch (error) {
                    console.log('æ·±åº¦DOMæ“ä½œå¤±è´¥:', error);
                    return false;
                }
                
                return true;
            }
            
            // 4. æé™æ¨¡æ‹ŸæŠ€æœ¯
            tryUltimateSimulation() {
                console.log('ä½¿ç”¨æé™æ¨¡æ‹ŸæŠ€æœ¯...');
                
                this.updateStatus('pressing', 'ğŸš€ å¯åŠ¨æé™è¯†åˆ«æ¨¡å¼...');
                
                // æ¨¡æ‹Ÿè®¾å¤‡ç‰¹å¾
                this.mockDeviceFeatures();
                
                // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ç‰¹å¾
                this.mockNetworkFeatures();
                
                // æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºç‰¹å¾
                this.mockUserBehaviorFeatures();
                
                setTimeout(() => {
                    this.simulateUltimatePress();
                }, 1000);
            }
            
            // æ¨¡æ‹Ÿä¼ä¸šçº§é•¿æŒ‰
            simulateEnterprisePress() {
                const rect = this.qrImage.getBoundingClientRect();
                
                // åˆ›å»ºå¸¦æœ‰ä¼ä¸šæƒé™æ ‡è¯†çš„äº‹ä»¶
                const enterpriseTouch = new TouchEvent('touchstart', {
                    bubbles: true,
                    cancelable: true,
                    touches: [{
                        identifier: 'enterprise_' + Date.now(),
                        target: this.qrImage,
                        clientX: rect.left + rect.width/2,
                        clientY: rect.top + rect.height/2,
                        // æ·»åŠ ä¼ä¸šåº”ç”¨ç‰¹å¾
                        __enterprise: true,
                        __whitelisted: true,
                        __permission_level: 'high'
                    }]
                });
                
                // æ·»åŠ ä¼ä¸šæ ‡è¯†åˆ°äº‹ä»¶
                Object.defineProperty(enterpriseTouch, '__ENTERPRISE_EVENT__', {
                    value: true,
                    writable: false
                });
                
                this.qrImage.dispatchEvent(enterpriseTouch);
                
                setTimeout(() => {
                    const enterpriseTouchEnd = new TouchEvent('touchend', {
                        bubbles: true,
                        cancelable: true,
                        changedTouches: [{
                            identifier: 'enterprise_' + Date.now(),
                            target: this.qrImage,
                            clientX: rect.left + rect.width/2,
                            clientY: rect.top + rect.height/2,
                            __enterprise: true,
                            __whitelisted: true
                        }]
                    });
                    
                    this.qrImage.dispatchEvent(enterpriseTouchEnd);
                    
                    // æ£€æŸ¥æ˜¯å¦æˆåŠŸ
                    setTimeout(() => {
                        this.checkEnterpriseResult();
                    }, 1000);
                    
                }, 2000);
            }
            
            // æ£€æŸ¥ä¼ä¸šæ¨¡å¼ç»“æœ
            checkEnterpriseResult() {
                // å¦‚æœä¼ä¸šæ¨¡å¼ä¹Ÿå¤±è´¥äº†ï¼Œæ˜¾ç¤ºè¯´æ˜
                this.updateStatus('error', 'ğŸ” å·²å°è¯•æ‰€æœ‰é«˜çº§è¯†åˆ«æŠ€æœ¯ï¼Œå¾®ä¿¡é™åˆ¶ä»ç„¶å­˜åœ¨');
                
                setTimeout(() => {
                    this.showAdvancedFailureTip();
                }, 1000);
            }
            
            // æ˜¾ç¤ºé«˜çº§å¤±è´¥æç¤º
            showAdvancedFailureTip() {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                `;
                
                modal.innerHTML = '<div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 450px; margin: 20px;"><h3>ğŸ” æŠ€æœ¯åˆ†æç»“æœ</h3><p style="margin: 15px 0; color: #666; text-align: left;"><strong>å·²å°è¯•çš„æŠ€æœ¯æ–¹æ¡ˆï¼š</strong><br/>âœ… å¾®ä¿¡å®˜æ–¹APIè°ƒç”¨<br/>âœ… ä¼ä¸šåº”ç”¨æƒé™æ¨¡æ‹Ÿ<br/>âœ… æ·±åº¦DOMæ“ä½œ<br/>âœ… æé™äº‹ä»¶æ¨¡æ‹Ÿ<br/>âœ… å‹åŠ›æ„Ÿåº”æ¨¡æ‹Ÿ</p><div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;"><p style="margin: 0; font-size: 14px; text-align: left;"><strong>åŒç¨‹æ—…è¡Œå¯èƒ½çš„å®ç°æ–¹å¼ï¼š</strong><br/>ğŸ¢ å¾®ä¿¡ä¼ä¸šç™½åå•æƒé™<br/>ğŸ”‘ ç‰¹æ®ŠAPIæ¥å£æˆæƒ<br/>ğŸ“± å°ç¨‹åºç‰¹æ®Šæƒé™<br/>ğŸ¤ ä¸å¾®ä¿¡å®˜æ–¹åˆä½œ</p></div><p style="font-size: 12px; color: #999; margin: 10px 0;">å»ºè®®è”ç³»å¾®ä¿¡å¼€æ”¾å¹³å°ç”³è¯·ç›¸å…³æƒé™</p><button onclick="this.parentElement.parentElement.remove()" style="margin-top: 15px; padding: 10px 25px; background: #1aad19; color: white; border: none; border-radius: 5px; cursor: pointer;">æˆ‘çŸ¥é“äº†</button></div>';
                
                document.body.appendChild(modal);
                
                setTimeout(() => {
                    if (modal.parentElement) {
                        modal.remove();
                    }
                }, 10000);
            }
            
            // æ¨¡æ‹Ÿè®¾å¤‡ç‰¹å¾
            mockDeviceFeatures() {
                // æ·»åŠ è®¾å¤‡ç‰¹å¾
                Object.defineProperty(navigator, 'deviceMemory', {
                    value: 4 + Math.random() * 4,
                    configurable: true
                });
                
                Object.defineProperty(navigator, 'hardwareConcurrency', {
                    value: 4 + Math.floor(Math.random() * 4),
                    configurable: true
                });
            }
            
            // æ¨¡æ‹Ÿç½‘ç»œç‰¹å¾
            mockNetworkFeatures() {
                // æ·»åŠ ç½‘ç»œè¿æ¥ä¿¡æ¯
                if (navigator.connection) {
                    Object.defineProperty(navigator.connection, 'effectiveType', {
                        value: '4g',
                        configurable: true
                    });
                }
            }
            
            // æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºç‰¹å¾
            mockUserBehaviorFeatures() {
                // æ·»åŠ ç”¨æˆ·äº¤äº’å†å²
                window.__USER_INTERACTION_COUNT__ = Math.floor(Math.random() * 20) + 5;
                window.__SESSION_START_TIME__ = Date.now() - (Math.random() * 300000);
            }
            
            // æé™å‹åŠ›æ¨¡æ‹Ÿ
            simulateUltimatePress() {
                console.log('æ‰§è¡Œæé™å‹åŠ›æ¨¡æ‹Ÿ...');
                
                const rect = this.qrImage.getBoundingClientRect();
                
                // åˆ›å»ºæœ€çœŸå®çš„è§¦æ‘¸åºåˆ—
                const touchPoints = [
                    { x: rect.left + rect.width * 0.4, y: rect.top + rect.height * 0.4 },
                    { x: rect.left + rect.width * 0.5, y: rect.top + rect.height * 0.5 },
                    { x: rect.left + rect.width * 0.6, y: rect.top + rect.height * 0.6 }
                ];
                
                touchPoints.forEach((point, index) => {
                    setTimeout(() => {
                        try {
                            const touch = new Touch({
                                identifier: Date.now() + index,
                                target: this.qrImage,
                                clientX: point.x,
                                clientY: point.y,
                                pageX: point.x,
                                pageY: point.y,
                                screenX: point.x,
                                screenY: point.y,
                                radiusX: 15 + Math.random() * 10,
                                radiusY: 15 + Math.random() * 10,
                                rotationAngle: Math.random() * 360,
                                force: 0.3 + Math.random() * 0.5
                            });
                            
                            const touchEvent = new TouchEvent('touchstart', {
                                bubbles: true,
                                cancelable: true,
                                touches: [touch],
                                targetTouches: [touch],
                                changedTouches: [touch]
                            });
                            
                            this.qrImage.dispatchEvent(touchEvent);
                            
                        } catch (error) {
                            console.log('Touchåˆ›å»ºå¤±è´¥ï¼Œä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆ');
                            
                            const mouseEvent = new MouseEvent('mousedown', {
                                bubbles: true,
                                cancelable: true,
                                clientX: point.x,
                                clientY: point.y,
                                button: 0,
                                pressure: 0.5 + Math.random() * 0.3
                            });
                            
                            this.qrImage.dispatchEvent(mouseEvent);
                        }
                    }, index * 200);
                });
                
                // æœ€ç»ˆæ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    this.checkEnterpriseResult();
                }, 2000);
                        }
            
            simulateQRResult() {
                // æ¨¡æ‹Ÿè¯†åˆ«ç»“æœ
                const mockData = 'https://u.wechat.com/ELAxxxxxxxxxxxx';
                this.updateStatus('success', 'è¯†åˆ«æˆåŠŸï¼å‘ç°å¾®ä¿¡æ·»åŠ å¥½å‹é“¾æ¥');
                
                setTimeout(() => {
                    this.handleQRResult(mockData);
                }, 1000);
            }
            
            handleQRResult(qrData) {
                console.log('äºŒç»´ç å†…å®¹:', qrData);
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯å¾®ä¿¡ç›¸å…³é“¾æ¥
                if (qrData.includes('wechat.com') || qrData.includes('weixin') || qrData.includes('u.wechat.com')) {
                    this.updateStatus('success', 'æ£€æµ‹åˆ°å¾®ä¿¡äºŒç»´ç ï¼æ­£åœ¨è·³è½¬...');
                    
                    setTimeout(() => {
                        this.redirectToWeChat(qrData);
                    }, 1500);
                } else if (qrData.startsWith('http')) {
                    this.updateStatus('success', 'æ£€æµ‹åˆ°ç½‘é¡µé“¾æ¥ï¼æ­£åœ¨è·³è½¬...');
                    
                    setTimeout(() => {
                        window.open(qrData, '_blank');
                        this.updateStatus('success', 'å·²åœ¨æ–°çª—å£æ‰“å¼€é“¾æ¥');
                    }, 1500);
                } else {
                    this.updateStatus('success', `è¯†åˆ«åˆ°å†…å®¹: ${qrData}`);
                }
                
                // 3ç§’åé‡ç½®çŠ¶æ€
                setTimeout(() => {
                    this.resetProgress();
                    this.updateStatus('idle', 'è¯†åˆ«å®Œæˆï¼ç‚¹å‡»å›¾ç‰‡å¯é‡æ–°è¯†åˆ«...');
                }, 3000);
            }
            
            redirectToWeChat(qrData) {

                console.log(qrData);
                // å°è¯•æ‰“å¼€å¾®ä¿¡
                const userAgent = navigator.userAgent.toLowerCase();
                
                if (userAgent.includes('micromessenger')) {
                    // åœ¨å¾®ä¿¡å†…éƒ¨ï¼Œç›´æ¥è·³è½¬
                    window.location.href = qrData;
                } else if (userAgent.includes('mobile')) {
                    // ç§»åŠ¨ç«¯ï¼Œå°è¯•ä½¿ç”¨å¾®ä¿¡scheme
                    const wechatScheme = `weixin://dl/business/?t=9XPl7k7i2lC`;
                    window.location.href = wechatScheme;
                    
                    // å¦‚æœå¾®ä¿¡schemeå¤±è´¥ï¼Œæç¤ºç”¨æˆ·
                    setTimeout(() => {
                        this.updateStatus('error', 'è¯·åœ¨å¾®ä¿¡ä¸­æ‰“å¼€æˆ–å¤åˆ¶é“¾æ¥åˆ°å¾®ä¿¡');
                    }, 2000);
                } else {
                    // æ¡Œé¢ç«¯ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    this.updateStatus('success', 'æ£€æµ‹åˆ°å¾®ä¿¡äºŒç»´ç ï¼è¯·åœ¨æ‰‹æœºå¾®ä¿¡ä¸­æ‰«æ');
                    
                    // åˆ›å»ºæç¤ºå¼¹çª—
                    this.showWeChatTip(qrData);
                }
            }
            
            showWeChatTip(qrData) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                `;
                
                modal.innerHTML = `
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 15px;
                        text-align: center;
                        max-width: 400px;
                        margin: 20px;
                    ">
                        <h3>ğŸ¯ è¯†åˆ«æˆåŠŸï¼</h3>
                        <p style="margin: 15px 0;">æ£€æµ‹åˆ°å¾®ä¿¡æ·»åŠ å¥½å‹äºŒç»´ç </p>
                        <p style="color: #666; font-size: 14px;">è¯·ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«ææ­¤äºŒç»´ç </p>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            margin-top: 20px;
                            padding: 10px 25px;
                            background: #1aad19;
                            color: white;
                            border: none;
                            border-radius: 5px;
                            cursor: pointer;
                        ">æˆ‘çŸ¥é“äº†</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // 3ç§’åè‡ªåŠ¨å…³é—­
                setTimeout(() => {
                    if (modal.parentElement) {
                        modal.remove();
                    }
                }, 5000);
            }
            
            updateStatus(type, message) {
                this.statusText.className = `status-text ${type}`;
                this.statusText.textContent = message;
            }
            
            // è‡ªåŠ¨å¼€å§‹è¯†åˆ«
            autoStartRecognition() {
                // æ£€æŸ¥æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒ
                const isWeChatEnv = navigator.userAgent.toLowerCase().includes('micromessenger') ||
                                  window.__wxjs_environment === 'miniprogram' ||
                                  window.wx !== undefined;
                
                if (isWeChatEnv) {
                    console.log('å¾®ä¿¡ç¯å¢ƒ - ä½¿ç”¨è‡ªç„¶æ“ä½œåºåˆ—');
                    this.startNaturalRecognitionSequence();
                } else {
                    console.log('æ™®é€šç¯å¢ƒ - ä½¿ç”¨ç›´æ¥è¯†åˆ«');
                    this.startDirectRecognition();
                }
            }
            
            // è‡ªç„¶è¯†åˆ«åºåˆ—ï¼ˆå¾®ä¿¡ä¸“ç”¨ï¼‰
            startNaturalRecognitionSequence() {
                // 1. å…ˆæ¨¡æ‹Ÿç”¨æˆ·æ³¨æ„åˆ°äºŒç»´ç 
                this.updateStatus('idle', 'è‡ªåŠ¨è¯†åˆ«å‡†å¤‡ä¸­...');
                
                setTimeout(() => {
                    // 2. æ¨¡æ‹Ÿç”¨æˆ·å°†å›¾ç‰‡æ»šåŠ¨åˆ°è§†å›¾ä¸­å¿ƒ
                    this.qrImage.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                    
                    this.updateStatus('idle', 'æ­£åœ¨åˆ†æå›¾ç‰‡å†…å®¹...');
                }, 1000 + Math.random() * 1000);
                
                setTimeout(() => {
                    // 3. æ¨¡æ‹Ÿç”¨æˆ·è½»å¾®çš„é¼ æ ‡ç§»åŠ¨ï¼ˆè¡¨ç¤ºå…³æ³¨ï¼‰
                    const rect = this.qrImage.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    // æ¨¡æ‹Ÿé¼ æ ‡é è¿‘å›¾ç‰‡
                    const mouseMove = new MouseEvent('mousemove', {
                        bubbles: true,
                        cancelable: true,
                        view: window,
                        clientX: centerX + (Math.random() - 0.5) * 50,
                        clientY: centerY + (Math.random() - 0.5) * 50
                    });
                    
                    document.dispatchEvent(mouseMove);
                    this.updateStatus('idle', 'è¯†åˆ«åˆ°äºŒç»´ç å›¾ç‰‡ï¼Œå‡†å¤‡åˆ†æ...');
                }, 2500 + Math.random() * 1500);
                
                setTimeout(() => {
                    // 4. æ¨¡æ‹Ÿç”¨æˆ·"æ€è€ƒ"æ˜¯å¦è¦è¯†åˆ«
                    this.updateStatus('idle', 'æ£€æµ‹åˆ°äºŒç»´ç ï¼Œç‚¹å‡»æˆ–é•¿æŒ‰è¯†åˆ«...');
                }, 4000 + Math.random() * 1000);
                
                setTimeout(() => {
                    // 5. æœ€åå¼€å§‹"ç”¨æˆ·ä¸»åŠ¨"çš„è¯†åˆ«æ“ä½œ
                    this.updateStatus('pressing', 'ğŸ¤– å¼€å§‹æ™ºèƒ½è¯†åˆ«...');
                    
                    // æ¨¡æ‹Ÿç”¨æˆ·é€æ¸æ„è¯†åˆ°å¯ä»¥é•¿æŒ‰
                    setTimeout(() => {
                        // é‡æ–°è·å–å›¾ç‰‡ä½ç½®
                        const rect = this.qrImage.getBoundingClientRect();
                        
                        // åˆ›å»ºä¸€ä¸ªçœ‹èµ·æ¥åƒç”¨æˆ·è§¦å‘çš„äº‹ä»¶
                        const naturalEvent = {
                            type: 'natural_user_action',
                            target: this.qrImage,
                            clientX: rect.left + rect.width/2 + (Math.random() - 0.5) * 30,
                            clientY: rect.top + rect.height/2 + (Math.random() - 0.5) * 30,
                            timeStamp: Date.now(),
                            preventDefault: () => {},
                            stopPropagation: () => {},
                            // è¿™ä¸ªä¼šè®©å¾®ä¿¡è®¤ä¸ºæ˜¯è‡ªç„¶ç”¨æˆ·è¡Œä¸º
                            isNaturalUserAction: true
                        };
                        
                        this.startPress(naturalEvent);
                    }, 500 + Math.random() * 800);
                    
                }, 6000 + Math.random() * 2000);
            }
            
            // ç›´æ¥è¯†åˆ«ï¼ˆéå¾®ä¿¡ç¯å¢ƒï¼‰
            startDirectRecognition() {
                const randomDelay = 800 + Math.random() * 1200;
                
                this.updateStatus('pressing', 'ğŸ¤– è‡ªåŠ¨è¯†åˆ«ä¸­...ä½¿ç”¨å¤šç§ç®—æ³•æå‡è¯†åˆ«ç‡');
                
                setTimeout(() => {
                    this.startPress({ type: 'auto', target: this.qrImage });
                }, randomDelay);
            }
            
            // å¯åŠ¨äººç±»éšæœºæ€§æ¨¡æ‹Ÿ
            startHumanRandomness() {
                // æ¯100-300msæ‰§è¡Œä¸€æ¬¡éšæœºæ•ˆæœ
                this.humanRandomnessTimer = setInterval(() => {
                    this.addHumanRandomness();
                }, 100 + Math.random() * 200);
            }
            
            // æ¨¡æ‹Ÿç”¨æˆ·è‡ªç„¶æ¢ç´¢é¡µé¢
            simulateNaturalExploration() {
                console.log('å¼€å§‹æ¨¡æ‹Ÿç”¨æˆ·è‡ªç„¶æ¢ç´¢...');
                
                const explorationSteps = [
                    () => this.simulateTextReading(),
                    () => this.simulateImageHover(),
                    () => this.simulateScrollExploration(),
                    () => this.simulateElementFocus()
                ];
                
                explorationSteps.forEach((step, index) => {
                    setTimeout(step, index * (800 + Math.random() * 600));
                });
            }
            
            // æ¨¡æ‹Ÿé˜…è¯»æ–‡å­—å†…å®¹
            simulateTextReading() {
                const textElements = document.querySelectorAll('h1, h2, p, .instructions');
                if (textElements.length > 0) {
                    const randomElement = textElements[Math.floor(Math.random() * textElements.length)];
                    randomElement.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                    
                    console.log('æ¨¡æ‹Ÿé˜…è¯»æ–‡å­—å†…å®¹');
                }
            }
            
            // æ¨¡æ‹Ÿé¼ æ ‡æ‚¬åœåœ¨å›¾ç‰‡ä¸Š
            simulateImageHover() {
                const img = document.getElementById('qrImage');
                if (img) {
                    // æ¨¡æ‹Ÿé¼ æ ‡è¿›å…¥å’Œç¦»å¼€
                    img.dispatchEvent(new MouseEvent('mouseenter', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    }));
                    
                    setTimeout(() => {
                        img.dispatchEvent(new MouseEvent('mouseleave', {
                            bubbles: true,
                            cancelable: true,
                            view: window
                        }));
                    }, 500 + Math.random() * 1000);
                    
                    console.log('æ¨¡æ‹Ÿå›¾ç‰‡æ‚¬åœ');
                }
            }
            
            // æ¨¡æ‹Ÿæ»šåŠ¨æ¢ç´¢
            simulateScrollExploration() {
                const scrollSteps = 3 + Math.floor(Math.random() * 3);
                let currentStep = 0;
                
                const scrollStep = () => {
                    if (currentStep < scrollSteps) {
                        const scrollDirection = Math.random() > 0.5 ? 1 : -1;
                        const scrollAmount = (20 + Math.random() * 80) * scrollDirection;
                        
                        window.scrollBy({
                            top: scrollAmount,
                            behavior: 'smooth'
                        });
                        
                        currentStep++;
                        setTimeout(scrollStep, 300 + Math.random() * 500);
                    } else {
                        // æœ€åå›åˆ°é¡¶éƒ¨
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    }
                };
                
                scrollStep();
                console.log('æ¨¡æ‹Ÿæ»šåŠ¨æ¢ç´¢');
            }
            
            // æ¨¡æ‹Ÿå…ƒç´ ç„¦ç‚¹
            simulateElementFocus() {
                const focusableElements = document.querySelectorAll('button, a, input, [tabindex]');
                if (focusableElements.length > 0) {
                    const randomElement = focusableElements[Math.floor(Math.random() * focusableElements.length)];
                    
                    // æ¨¡æ‹ŸTabå¯¼èˆª
                    randomElement.dispatchEvent(new FocusEvent('focus', {
                        bubbles: true,
                        cancelable: true
                    }));
                    
                    setTimeout(() => {
                        randomElement.dispatchEvent(new FocusEvent('blur', {
                            bubbles: true,
                            cancelable: true
                        }));
                    }, 200 + Math.random() * 400);
                    
                    console.log('æ¨¡æ‹Ÿå…ƒç´ ç„¦ç‚¹');
                }
            }
            
            // é«˜çº§äº‹ä»¶æ¨¡æ‹Ÿï¼ˆç”¨äºæ‰‹åŠ¨ç‚¹å‡»è§¦å‘ï¼‰
            advancedEventSimulation() {
                console.log('å¼€å§‹é«˜çº§äº‹ä»¶æ¨¡æ‹Ÿ...');
                
                const rect = this.qrImage.getBoundingClientRect();
                
                // æ·»åŠ éšæœºåç§»ï¼Œæ¨¡æ‹Ÿä¸ç²¾ç¡®çš„è§¦æ‘¸
                const randomX = rect.left + rect.width/2 + (Math.random() - 0.5) * 20;
                const randomY = rect.top + rect.height/2 + (Math.random() - 0.5) * 20;
                
                // åˆ›å»ºæ¨¡æ‹Ÿçš„äº‹ä»¶å¯¹è±¡
                const mockEvent = {
                    type: 'simulated_touch',
                    target: this.qrImage,
                    clientX: randomX,
                    clientY: randomY,
                    preventDefault: () => {},
                    stopPropagation: () => {},
                    // æ¨¡æ‹ŸisTrustedä¸ºtrue (å°½ç®¡å®é™…ä¸Šä¸ä¼šç”Ÿæ•ˆï¼Œä½†å¢åŠ çœŸå®æ€§)
                    isTrusted: true,
                    timeStamp: Date.now(),
                    detail: 1
                };
                
                // æ·»åŠ éšæœºçš„é¢„è§¦æ‘¸å»¶è¿Ÿ
                const preDelay = 50 + Math.random() * 150;
                
                setTimeout(() => {
                    // å¼€å§‹é•¿æŒ‰
                    this.startPress(mockEvent);
                    
                    // åœ¨é•¿æŒ‰è¿‡ç¨‹ä¸­æ·»åŠ å¾®å°çš„"æ‰‹æŠ–"æ¨¡æ‹Ÿ
                    const shakeDuration = this.LONG_PRESS_DURATION * 0.8;
                    const shakeInterval = setInterval(() => {
                        if (this.isPressed) {
                            // è½»å¾®æ”¹å˜å›¾ç‰‡çš„ä½ç½®æ¨¡æ‹Ÿæ‰‹æŠ–
                            const shakeX = (Math.random() - 0.5) * 2;
                            const shakeY = (Math.random() - 0.5) * 2;
                            this.qrImage.style.transform = `scale(0.98) translate(${shakeX}px, ${shakeY}px)`;
                        } else {
                            clearInterval(shakeInterval);
                        }
                    }, 100 + Math.random() * 100);
                    
                    setTimeout(() => {
                        clearInterval(shakeInterval);
                    }, shakeDuration);
                    
                }, preDelay);
                
                console.log('é«˜çº§äº‹ä»¶æ¨¡æ‹Ÿå·²å¯åŠ¨ï¼Œä½¿ç”¨éšæœºå‚æ•°:', {
                    x: randomX.toFixed(2),
                    y: randomY.toFixed(2),
                    preDelay: preDelay.toFixed(0) + 'ms',
                    duration: this.LONG_PRESS_DURATION.toFixed(0) + 'ms'
                });
            }
            
            // æ¨¡æ‹ŸçœŸå®è§¦æ‘¸äº‹ä»¶ï¼ˆæ”¹è¿›ç‰ˆï¼‰
            simulateRealTouch() {
                // è¿™ä¸ªæ–¹æ³•ä¿ç•™ç”¨äºæ›´å¤æ‚çš„DOMäº‹ä»¶æ¨¡æ‹Ÿ
                console.log('æ¨¡æ‹ŸçœŸå®DOMäº‹ä»¶...');
                
                const rect = this.qrImage.getBoundingClientRect();
                const randomX = rect.left + rect.width/2 + (Math.random() - 0.5) * 20;
                const randomY = rect.top + rect.height/2 + (Math.random() - 0.5) * 20;
                
                // åˆ›å»ºæ›´ç®€å•ä½†æœ‰æ•ˆçš„é¼ æ ‡äº‹ä»¶
                try {
                    const mouseDown = new MouseEvent('mousedown', {
                        bubbles: true,
                        cancelable: true,
                        view: window,
                        clientX: randomX,
                        clientY: randomY,
                        button: 0,
                        buttons: 1,
                        detail: 1
                    });
                    
                    // åˆ†æ´¾é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
                    this.qrImage.dispatchEvent(mouseDown);
                    
                    // éšæœºå»¶è¿Ÿååˆ†æ´¾é¼ æ ‡é‡Šæ”¾äº‹ä»¶
                    const holdTime = 1300 + Math.random() * 500;
                    setTimeout(() => {
                        const mouseUp = new MouseEvent('mouseup', {
                            bubbles: true,
                            cancelable: true,
                            view: window,
                            clientX: randomX + (Math.random() - 0.5) * 5,
                            clientY: randomY + (Math.random() - 0.5) * 5,
                            button: 0,
                            buttons: 0,
                            detail: 1
                        });
                        
                        this.qrImage.dispatchEvent(mouseUp);
                    }, holdTime);
                    
                    console.log('çœŸå®DOMäº‹ä»¶å·²åˆ†æ´¾');
                    
                } catch (error) {
                    console.warn('DOMäº‹ä»¶åˆ›å»ºå¤±è´¥ï¼Œä½¿ç”¨é«˜çº§æ¨¡æ‹Ÿ:', error);
                    this.advancedEventSimulation();
                }
            }
            
            // åˆ›å»ºTouchListçš„è¾…åŠ©æ–¹æ³•ï¼ˆæ”¹è¿›å…¼å®¹æ€§ï¼‰
            createTouchList(x, y) {
                try {
                    // ç°ä»£æµè§ˆå™¨æ”¯æŒTouchæ„é€ å‡½æ•°
                    const touch = new Touch({
                        identifier: Date.now(),
                        target: this.qrImage,
                        clientX: x,
                        clientY: y,
                        pageX: x,
                        pageY: y,
                        screenX: x,
                        screenY: y,
                        radiusX: 11.5,
                        radiusY: 11.5,
                        rotationAngle: 0,
                        force: 0.5
                    });
                    
                    return [touch];
                } catch (e) {
                    // é™çº§å¤„ç†ï¼šåˆ›å»ºç±»ä¼¼Touchçš„å¯¹è±¡
                    console.warn('Touch constructor not supported, using fallback');
                    return [{
                        identifier: Date.now(),
                        target: this.qrImage,
                        clientX: x,
                        clientY: y,
                        pageX: x,
                        pageY: y,
                        screenX: x,
                        screenY: y,
                        radiusX: 11.5,
                        radiusY: 11.5,
                        rotationAngle: 0,
                        force: 0.5
                    }];
                }
            }
            
            // é«˜çº§åæ£€æµ‹ï¼šæ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒæ£€æŸ¥
            checkEnvironment() {
                // æ£€æŸ¥æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒ
                const userAgent = navigator.userAgent.toLowerCase();
                const isWeChat = userAgent.includes('micromessenger');
                const isMiniProgram = window.__wxjs_environment === 'miniprogram' || 
                                    window.wx !== undefined || 
                                    userAgent.includes('miniprogram');
                
                console.log('ç¯å¢ƒæ£€æµ‹:', {
                    isWeChat,
                    isMiniProgram,
                    userAgent: userAgent.substring(0, 50)
                });
                
                if (isWeChat || isMiniProgram) {
                    // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒéœ€è¦æ›´ä¸¥æ ¼çš„åæ£€æµ‹
                    this.setupMiniProgramBehavior();
                    
                    // å¤§å¹…å¢åŠ å»¶è¿Ÿå’Œéšæœºæ€§
                    this.LONG_PRESS_DURATION = 1600 + Math.random() * 600; // 1.6-2.2ç§’
                    this.PROGRESS_INTERVAL = 60 + Math.random() * 30; // 60-90ms
                    
                    return true;
                }
                
                return false;
            }
            
            // å¾®ä¿¡å°ç¨‹åºä¸“ç”¨è¡Œä¸ºè®¾ç½®
            setupMiniProgramBehavior() {
                console.log('è®¾ç½®å¾®ä¿¡å°ç¨‹åºä¸“ç”¨è¡Œä¸º...');
                
                // 1. æ¨¡æ‹Ÿç”¨æˆ·çœŸå®çš„é¡µé¢äº¤äº’åºåˆ—
                this.simulateUserPageInteraction();
                
                // 2. æ·»åŠ é¡µé¢ç„¦ç‚¹å˜åŒ–ç›‘å¬
                this.addFocusBlurSimulation();
                
                // 3. æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿå’ŒåŠ è½½æ—¶é—´
                this.simulateNetworkBehavior();
                
                // 4. æ·»åŠ è§¦æ‘¸è®¾å¤‡ç‰¹å¾
                this.addTouchDeviceFeatures();
            }
            
            // æ¨¡æ‹Ÿç”¨æˆ·çœŸå®çš„é¡µé¢äº¤äº’åºåˆ—
            simulateUserPageInteraction() {
                // æ¨¡æ‹Ÿç”¨æˆ·è¿›å…¥é¡µé¢åçš„å…¸å‹è¡Œä¸º
                const interactions = [
                    () => this.simulatePageScroll(),
                    () => this.simulatePageVisibility(),
                    () => this.simulateUserReading(),
                    () => this.simulateImageLoad()
                ];
                
                interactions.forEach((interaction, index) => {
                    setTimeout(interaction, (index + 1) * (300 + Math.random() * 500));
                });
            }
            
            // æ¨¡æ‹Ÿé¡µé¢æ»šåŠ¨
            simulatePageScroll() {
                const scrollAmount = Math.random() * 100;
                window.scrollTo({
                    top: scrollAmount,
                    behavior: 'smooth'
                });
                
                setTimeout(() => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }, 200 + Math.random() * 300);
            }
            
            // æ¨¡æ‹Ÿé¡µé¢å¯è§æ€§å˜åŒ–
            simulatePageVisibility() {
                // è§¦å‘é¡µé¢å¯è§æ€§äº‹ä»¶
                document.dispatchEvent(new Event('visibilitychange'));
                
                setTimeout(() => {
                    // æ¨¡æ‹Ÿç”¨æˆ·é‡æ–°å…³æ³¨é¡µé¢
                    window.dispatchEvent(new Event('focus'));
                }, 100 + Math.random() * 200);
            }
            
            // æ¨¡æ‹Ÿç”¨æˆ·é˜…è¯»æ—¶é—´
            simulateUserReading() {
                // æ¨¡æ‹Ÿç”¨æˆ·æŸ¥çœ‹é¡µé¢å†…å®¹çš„æ—¶é—´
                const readingTime = 2000 + Math.random() * 3000; // 2-5ç§’
                console.log(`æ¨¡æ‹Ÿç”¨æˆ·é˜…è¯»æ—¶é—´: ${readingTime.toFixed(0)}ms`);
                
                // åœ¨é˜…è¯»æœŸé—´éšæœºè§¦å‘ä¸€äº›å¾®å°çš„äº¤äº’
                const readingInterval = setInterval(() => {
                    if (Math.random() < 0.3) {
                        // 30% æ¦‚ç‡æ¨¡æ‹Ÿç”¨æˆ·å¾®å°çš„æ»šåŠ¨
                        window.scrollBy(0, (Math.random() - 0.5) * 10);
                    }
                }, 500 + Math.random() * 1000);
                
                setTimeout(() => {
                    clearInterval(readingInterval);
                }, readingTime);
            }
            
            // æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½
            simulateImageLoad() {
                const img = document.getElementById('qrImage');
                if (img) {
                    // æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½å®Œæˆäº‹ä»¶
                    img.dispatchEvent(new Event('load'));
                    
                    // æ¨¡æ‹Ÿç”¨æˆ·æ³¨æ„åˆ°å›¾ç‰‡
                    setTimeout(() => {
                        img.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }, 100 + Math.random() * 300);
                }
            }
            
            // æ·»åŠ ç„¦ç‚¹æ¨¡ç³Šæ¨¡æ‹Ÿ
            addFocusBlurSimulation() {
                let focusCount = 0;
                const maxFocusEvents = 3 + Math.floor(Math.random() * 3);
                
                const focusSimulation = () => {
                    if (focusCount < maxFocusEvents) {
                        setTimeout(() => {
                            window.dispatchEvent(new Event('blur'));
                            setTimeout(() => {
                                window.dispatchEvent(new Event('focus'));
                                focusCount++;
                                focusSimulation();
                            }, 200 + Math.random() * 500);
                        }, 1000 + Math.random() * 2000);
                    }
                };
                
                focusSimulation();
            }
            
            // æ¨¡æ‹Ÿç½‘ç»œè¡Œä¸º
            simulateNetworkBehavior() {
                // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å»¶è¿Ÿ
                const simulatedNetworkDelay = 100 + Math.random() * 300;
                
                setTimeout(() => {
                    // è§¦å‘ä¸€ä¸ªå‡çš„ç½‘ç»œå®Œæˆäº‹ä»¶
                    window.dispatchEvent(new CustomEvent('networkready', {
                        detail: { delay: simulatedNetworkDelay }
                    }));
                }, simulatedNetworkDelay);
            }
            
            // æ·»åŠ è§¦æ‘¸è®¾å¤‡ç‰¹å¾
            addTouchDeviceFeatures() {
                // æ¨¡æ‹Ÿè§¦æ‘¸è®¾å¤‡çš„ç‰¹å¾
                if ('ontouchstart' in window) {
                    // æ·»åŠ è§¦æ‘¸è®¾å¤‡ç‰¹æœ‰çš„äº‹ä»¶ç›‘å¬
                    document.addEventListener('touchstart', () => {}, { passive: true });
                    document.addEventListener('touchmove', () => {}, { passive: true });
                    document.addEventListener('touchend', () => {}, { passive: true });
                }
                
                // æ¨¡æ‹Ÿè®¾å¤‡æ–¹å‘å˜åŒ–
                setTimeout(() => {
                    window.dispatchEvent(new Event('orientationchange'));
                }, 500 + Math.random() * 1000);
            }
            
            // æ¨¡æ‹Ÿäººç±»æ“ä½œçš„éšæœºæ€§
            addHumanRandomness() {
                // åœ¨é•¿æŒ‰è¿‡ç¨‹ä¸­æ·»åŠ è½»å¾®çš„"æ‰‹æŠ–"æ•ˆæœ
                if (this.isPressed && Math.random() < 0.3) {
                    // 30%æ¦‚ç‡æ·»åŠ å¾®å°çš„è§†è§‰åé¦ˆå˜åŒ–
                    this.qrImage.style.transform = `scale(0.98) rotate(${(Math.random() - 0.5) * 0.5}deg)`;
                    
                    setTimeout(() => {
                        this.qrImage.style.transform = 'scale(0.98)';
                    }, 50 + Math.random() * 100);
                }
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const detector = new QRLongPressDetector();
            
            // æ£€æŸ¥ç¯å¢ƒå¹¶è°ƒæ•´è¡Œä¸º
            const isWeChatEnv = detector.checkEnvironment();
            
            // ç­‰å¾…ç”¨æˆ·è¡Œä¸ºæ¨¡æ‹Ÿå®Œæˆåå†å¯åŠ¨è‡ªåŠ¨è¯†åˆ«
            const userBehaviorDuration = isWeChatEnv ? 8000 : 3000; // å¾®ä¿¡ç¯å¢ƒéœ€è¦æ›´é•¿æ—¶é—´
            const randomDelay = userBehaviorDuration + Math.random() * 3000;
            
            console.log('ç¯å¢ƒ:', isWeChatEnv ? 'å¾®ä¿¡å°ç¨‹åº' : 'æ™®é€šæµè§ˆå™¨', ', å»¶è¿Ÿ:', randomDelay.toFixed(0) + 'ms');
            
            // ç›‘å¬ç½‘ç»œå°±ç»ªäº‹ä»¶ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            let networkReady = false;
            window.addEventListener('networkready', () => {
                networkReady = true;
                console.log('ç½‘ç»œæ¨¡æ‹Ÿå®Œæˆ');
            });
            
            setTimeout(() => {
                // ç¡®ä¿ç½‘ç»œæ¨¡æ‹Ÿä¹Ÿå®Œæˆäº†
                if (isWeChatEnv && !networkReady) {
                    console.log('ç­‰å¾…ç½‘ç»œæ¨¡æ‹Ÿå®Œæˆ...');
                    setTimeout(() => {
                        detector.autoStartRecognition();
                    }, 1000);
                } else {
                    detector.autoStartRecognition();
                }
            }, randomDelay);
            
            // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬ï¼ˆå¢åŠ çœŸå®æ€§ï¼‰
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    console.log('é¡µé¢éšè—ï¼Œæš‚åœæ“ä½œ');
                } else {
                    console.log('é¡µé¢æ˜¾ç¤ºï¼Œæ¢å¤æ“ä½œ');
                    // æ¨¡æ‹Ÿç”¨æˆ·é‡æ–°å…³æ³¨é¡µé¢
                    if (isWeChatEnv) {
                        setTimeout(() => {
                            window.scrollBy(0, (Math.random() - 0.5) * 20);
                        }, 100 + Math.random() * 300);
                    }
                }
            });
            
            // ä¸ºå¾®ä¿¡ç¯å¢ƒæ·»åŠ é¢å¤–çš„ç”¨æˆ·è¡Œä¸ºç›‘å¬
            if (isWeChatEnv) {
                // ç›‘å¬è§¦æ‘¸äº‹ä»¶ä»¥å¢åŠ çœŸå®æ€§
                let touchCount = 0;
                document.addEventListener('touchstart', (e) => {
                    touchCount++;
                    console.log('çœŸå®è§¦æ‘¸äº‹ä»¶ #' + touchCount);
                }, { passive: true });
                
                // æ¨¡æ‹Ÿç”¨æˆ·å¯¹é¡µé¢çš„è‡ªç„¶æ¢ç´¢
                setTimeout(() => {
                    detector.simulateNaturalExploration();
                }, 2000 + Math.random() * 2000);
            }
        });
    </script>
</body>
</html>